## Codebase Patterns
- Godot scene files (.tscn) use GDScript format=3 with uid references
- Export presets configured in export_presets.cfg (separate from project.godot)
- Audio bus layout stored in default_bus_layout.tres with dB volume levels
- Project uses config_version=5 for Godot 4.2+
- Use autoload (singletons) in project.godot for global managers (GameManager, TranslationManager, Database, SessionManager)
- Localization files use JSON format in /assets/locales/{locale}.json
- Translation keys use snake_case format for consistency
- Persistent data stored in user:// directory (cross-platform)
- SQLite operations require gdsqlite plugin (not built into Godot 4.2)
- Session tracking via SessionManager: start_session() -> record_tap() -> end_session()

## [2025-01-23] - US-001
- Created Godot 4.2 project with project.godot configured (config_version=5)
- Set up folder structure: /assets/sounds, /assets/textures, /assets/locales, /scenes, /scripts
- Created Main.tscn scene with Node2D root
- Configured Android 8.0+ (API 26) export preset in export_presets.cfg
- Set Application/config/name to 'PlayTap'
- Set viewport to 540x960 (portrait mode)
- Added GameManager.gd autoload singleton with signals (game_started, game_ended, reward_trigger)
- Created default_bus_layout.tres with Master (0dB), Background (-8dB), SFX (-3dB), Voice (-4dB) buses
- Added project icon.svg and .gitignore for Godot projects

**Files changed:**
- project.godot (new)
- export_presets.cfg (new)
- default_bus_layout.tres (new)
- icon.svg (new)
- scenes/Main.tscn (new)
- scripts/GameManager.gd (new)
- .gitignore (new)

**Learnings for future iterations:**
- Godot scene files use `[gd_scene load_steps=X format=3 uid="uid://..."]` header format
- Export presets are separate from project.godot, stored in export_presets.cfg
- Audio buses use dB values: 0dB is full volume, negative values reduce volume
- Android minimum platform version is set via binary_format/minimum_platform_version=26 in export_presets.cfg
- Viewport size is set in project.godot under [display] section with window/size/viewport_width and viewport_height
- Autoload scripts are registered in [autoload] section with "*res://" prefix
- Use .gitignore to exclude .godot/, import/, and build directories

## [2025-01-23] - US-002
- Audio bus architecture was completed as part of US-001
- default_bus_layout.tres includes all required buses: Master (0dB), Background (-8dB), SFX (-3dB), Voice (-4dB)
- No additional implementation needed

**Files changed:**
- None (completed in US-001)

**Learnings for future iterations:**
- Audio bus layout can be created during initial project setup
- Bus layout is referenced in export_presets.cfg under audio/buses/default_bus_layout

---

## [2025-01-23] - US-003
- Created TranslationManager.gd autoload singleton with get_text(key) function
- Created /assets/locales/id.json with Indonesian translations
- Created /assets/locales/en.json with English translations
- All localization keys use snake_case format (e.g., game_tap_pop_name, color_red)
- Added TranslationManager to autoloads in project.godot
- Project locale set to 'id' as default in [locale] section
- TranslationManager supports language switching with set_locale() and emits language_changed signal

**Files changed:**
- scripts/TranslationManager.gd (new)
- assets/locales/id.json (new)
- assets/locales/en.json (new)
- project.godot (updated with TranslationManager autoload)

**Learnings for future iterations:**
- Localization files are JSON format with key-value pairs
- TranslationManager uses FileAccess to load locale files at runtime
- Fallback to key name if translation not found (prevents crashes)
- Use TranslationManager.get_text("key") from anywhere in code to get translated strings
- Add new translations to both locale files to maintain parity

## [2025-01-23] - US-004
- Created MainMenu.tscn scene with Control root and game button grid
- Created GameSceneBase.tscn template for mini-games with common UI
- GameManager.gd already exists with required signals (game_started, game_ended, reward_trigger)
- fade_to_scene(scene_path) function already implemented with 1s tween in GameManager
- Created MainMenu.gd with game button handlers using GameManager.fade_to_scene()
- Created GameSceneBase.gd as base class with virtual functions for game lifecycle
- Updated project.godot to use MainMenu.tscn as main scene
- GameSceneBase provides _on_game_start(), _on_game_end(), _get_game_metrics() hooks

**Files changed:**
- scenes/MainMenu.tscn (new)
- scenes/GameSceneBase.tscn (new)
- scripts/MainMenu.gd (new)
- scripts/GameSceneBase.gd (new)
- project.godot (updated main_scene path)

**Learnings for future iterations:**
- Game scenes should extend GameSceneBase for consistent UI and lifecycle
- Use GameManager.fade_to_scene() for all scene transitions
- GameSceneBase.virtual functions: override _on_game_start() for init, _on_game_end() for cleanup
- Back button in games should return to MainMenu.tscn
- All game scenes should set game_name variable for proper session tracking

## [2025-01-23] - US-005
- Created Database.gd script with connection logic for gdsqlite plugin
- Created sessions table with schema: id INTEGER PRIMARY KEY, game_type TEXT, start_time TIMESTAMP, duration_seconds INTEGER, metrics TEXT
- Created paintings table with schema: id INTEGER PRIMARY KEY, source TEXT, filepath TEXT, created_at TIMESTAMP
- Database initialized in user://playtap.db path
- Implemented helper functions: log_session(), get_paintings(), delete_old_sessions()
- Added additional functions: save_painting(), delete_painting(), get_session_stats(), get_todays_play_count()
- Created indexes on start_time and created_at for query performance
- Added Database to autoloads in project.godot
- Database emits signals: database_initialized(success), session_logged(game_type), painting_saved(filepath)
- NOTE: Requires gdsqlite plugin (https://github.com/godotot/gdsqlite) - not built into Godot 4.2

**Files changed:**
- scripts/Database.gd (new)
- project.godot (updated with Database autoload)

**Learnings for future iterations:**
- Godot 4.2 doesn't include SQLite support - requires gdsqlite plugin
- Use user:// path for all persistent data (cross-platform)
- SQLite datetime('now') uses UTC, date('now') for dates only
- Use indexes on timestamp columns for better query performance
- Metrics stored as JSON string in database - use JSON.stringify() and JSON.parse()
- ClassDB.class_exists("SQLite") checks if gdsqlite is available
- Always handle database connection failures gracefully with error messages

## [2025-01-23] - US-006
- Created SessionManager.gd autoload singleton for tracking gameplay metrics
- Variables: current_game, start_time, tap_count, content_category
- Functions: start_session(game_name), end_session(), record_tap(), get_session_duration()
- Auto-saves session to database on end_session() call via Database.log_session()
- Session data written to user:// directory only (no cloud sync)
- Added signals: session_started(game_name, category), session_ended(game_name, duration, metrics), tap_recorded(count)
- Added metric system: set_metric(key, value), get_metric(key, default), get_all_metrics()
- Auto-end conditions: 10 minutes (600s) or 60 taps - configurable via set_auto_end_conditions()
- Added SessionManager to autoloads in project.godot

**Files changed:**
- scripts/SessionManager.gd (new)
- project.godot (updated with SessionManager autoload)

**Learnings for future iterations:**
- SessionManager uses Time.get_unix_time_from_system() for timestamps
- start_session() ends any existing session first (prevents double-session bugs)
- Metrics are Dictionary with tap_count and content_category automatically added
- Call SessionManager.record_tap() for each user interaction
- Games can set custom auto-end limits (e.g., puzzles may end after completion, not taps)
- SessionManager.check_auto_end_conditions() should be called in game _process() or timer
- Use content_category for analytics: "cognitive" (puzzles), "creative" (painting), "musical" (piano)
---

