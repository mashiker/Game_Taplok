## Codebase Patterns
- Godot scene files (.tscn) use GDScript format=3 with uid references
- Export presets configured in export_presets.cfg (separate from project.godot)
- Audio bus layout stored in default_bus_layout.tres with dB volume levels
- Project uses config_version=5 for Godot 4.2+
- Use autoload (singletons) in project.godot for global managers (GameManager, TranslationManager, Database, SessionManager, AudioManager)
- Localization files use JSON format in /assets/locales/{locale}.json
- Translation keys use snake_case format for consistency
- Persistent data stored in user:// directory (cross-platform)
- SQLite operations require gdsqlite plugin (not built into Godot 4.2)
- Session tracking via SessionManager: start_session() -> record_tap() -> end_session()
- Audio playback via AudioManager: play_sfx(), play_voice(), play_music()
- Audio bus ducking: voice automatically reduces SFX volume by 12dB during playback
- Drag and drop pattern: 10px deadzone, modulate.a=0.7 opacity, scale=1.1, z_index=100 during drag
- AABB overlap check for drop detection: compare global_position and size rectangles
- Content progression: session_number based content sets, shuffle on load, track completion count
- Meta data storage: set_meta("key", value) / get_meta("key", default) on nodes for answer validation
- Tween sequences: use tween.set_parallel(true) for simultaneous animations, await tween.finished for sequential
- Session categories: "cognitive" (puzzles), "creative" (painting), "musical" (piano) for analytics
- Game scenes extend Control with GameSceneBase pattern: _on_game_start(), _on_game_end(), _get_game_metrics() hooks
- Input handling: connect gui_input signals in _ready(), use is_transitioning flag to block during animations
- Image manipulation: use Image.get_pixel() and set_pixel() for per-pixel operations (flood fill, drawing)
- Flood fill algorithm: stack-based approach with visited tracking to avoid infinite loops
- Template images stored in /assets/textures/coloring_templates/ as PNG files with black outlines on white background
- Undo stack: store Image.duplicate() snapshots, max 20 states, pop_front() when limit exceeded
- Age-based content filtering: use GameManager.get_child_age() to determine template complexity
- Export resolution: display at 800x600, export at 1200x900 using Image.resize() with INTERPOLATE_NEAREST
- TextureRect for canvas display with ImageTexture updated via set_image() after pixel changes

## [2025-01-23] - US-001
- Created Godot 4.2 project with project.godot configured (config_version=5)
- Set up folder structure: /assets/sounds, /assets/textures, /assets/locales, /scenes, /scripts
- Created Main.tscn scene with Node2D root
- Configured Android 8.0+ (API 26) export preset in export_presets.cfg
- Set Application/config/name to 'PlayTap'
- Set viewport to 540x960 (portrait mode)
- Added GameManager.gd autoload singleton with signals (game_started, game_ended, reward_trigger)
- Created default_bus_layout.tres with Master (0dB), Background (-8dB), SFX (-3dB), Voice (-4dB) buses
- Added project icon.svg and .gitignore for Godot projects

**Files changed:**
- project.godot (new)
- export_presets.cfg (new)
- default_bus_layout.tres (new)
- icon.svg (new)
- scenes/Main.tscn (new)
- scripts/GameManager.gd (new)
- .gitignore (new)

**Learnings for future iterations:**
- Godot scene files use `[gd_scene load_steps=X format=3 uid="uid://..."]` header format
- Export presets are separate from project.godot, stored in export_presets.cfg
- Audio buses use dB values: 0dB is full volume, negative values reduce volume
- Android minimum platform version is set via binary_format/minimum_platform_version=26 in export_presets.cfg
- Viewport size is set in project.godot under [display] section with window/size/viewport_width and viewport_height
- Autoload scripts are registered in [autoload] section with "*res://" prefix
- Use .gitignore to exclude .godot/, import/, and build directories

## [2025-01-23] - US-002
- Audio bus architecture was completed as part of US-001
- default_bus_layout.tres includes all required buses: Master (0dB), Background (-8dB), SFX (-3dB), Voice (-4dB)
- No additional implementation needed

**Files changed:**
- None (completed in US-001)

**Learnings for future iterations:**
- Audio bus layout can be created during initial project setup
- Bus layout is referenced in export_presets.cfg under audio/buses/default_bus_layout

---

## [2025-01-23] - US-003
- Created TranslationManager.gd autoload singleton with get_text(key) function
- Created /assets/locales/id.json with Indonesian translations
- Created /assets/locales/en.json with English translations
- All localization keys use snake_case format (e.g., game_tap_pop_name, color_red)
- Added TranslationManager to autoloads in project.godot
- Project locale set to 'id' as default in [locale] section
- TranslationManager supports language switching with set_locale() and emits language_changed signal

**Files changed:**
- scripts/TranslationManager.gd (new)
- assets/locales/id.json (new)
- assets/locales/en.json (new)
- project.godot (updated with TranslationManager autoload)

**Learnings for future iterations:**
- Localization files are JSON format with key-value pairs
- TranslationManager uses FileAccess to load locale files at runtime
- Fallback to key name if translation not found (prevents crashes)
- Use TranslationManager.get_text("key") from anywhere in code to get translated strings
- Add new translations to both locale files to maintain parity

## [2025-01-23] - US-004
- Created MainMenu.tscn scene with Control root and game button grid
- Created GameSceneBase.tscn template for mini-games with common UI
- GameManager.gd already exists with required signals (game_started, game_ended, reward_trigger)
- fade_to_scene(scene_path) function already implemented with 1s tween in GameManager
- Created MainMenu.gd with game button handlers using GameManager.fade_to_scene()
- Created GameSceneBase.gd as base class with virtual functions for game lifecycle
- Updated project.godot to use MainMenu.tscn as main scene
- GameSceneBase provides _on_game_start(), _on_game_end(), _get_game_metrics() hooks

**Files changed:**
- scenes/MainMenu.tscn (new)
- scenes/GameSceneBase.tscn (new)
- scripts/MainMenu.gd (new)
- scripts/GameSceneBase.gd (new)
- project.godot (updated main_scene path)

**Learnings for future iterations:**
- Game scenes should extend GameSceneBase for consistent UI and lifecycle
- Use GameManager.fade_to_scene() for all scene transitions
- GameSceneBase.virtual functions: override _on_game_start() for init, _on_game_end() for cleanup
- Back button in games should return to MainMenu.tscn
- All game scenes should set game_name variable for proper session tracking

## [2025-01-23] - US-005
- Created Database.gd script with connection logic for gdsqlite plugin
- Created sessions table with schema: id INTEGER PRIMARY KEY, game_type TEXT, start_time TIMESTAMP, duration_seconds INTEGER, metrics TEXT
- Created paintings table with schema: id INTEGER PRIMARY KEY, source TEXT, filepath TEXT, created_at TIMESTAMP
- Database initialized in user://playtap.db path
- Implemented helper functions: log_session(), get_paintings(), delete_old_sessions()
- Added additional functions: save_painting(), delete_painting(), get_session_stats(), get_todays_play_count()
- Created indexes on start_time and created_at for query performance
- Added Database to autoloads in project.godot
- Database emits signals: database_initialized(success), session_logged(game_type), painting_saved(filepath)
- NOTE: Requires gdsqlite plugin (https://github.com/godotot/gdsqlite) - not built into Godot 4.2

**Files changed:**
- scripts/Database.gd (new)
- project.godot (updated with Database autoload)

**Learnings for future iterations:**
- Godot 4.2 doesn't include SQLite support - requires gdsqlite plugin
- Use user:// path for all persistent data (cross-platform)
- SQLite datetime('now') uses UTC, date('now') for dates only
- Use indexes on timestamp columns for better query performance
- Metrics stored as JSON string in database - use JSON.stringify() and JSON.parse()
- ClassDB.class_exists("SQLite") checks if gdsqlite is available
- Always handle database connection failures gracefully with error messages

## [2025-01-23] - US-006
- Created SessionManager.gd autoload singleton for tracking gameplay metrics
- Variables: current_game, start_time, tap_count, content_category
- Functions: start_session(game_name), end_session(), record_tap(), get_session_duration()
- Auto-saves session to database on end_session() call via Database.log_session()
- Session data written to user:// directory only (no cloud sync)
- Added signals: session_started(game_name, category), session_ended(game_name, duration, metrics), tap_recorded(count)
- Added metric system: set_metric(key, value), get_metric(key, default), get_all_metrics()
- Auto-end conditions: 10 minutes (600s) or 60 taps - configurable via set_auto_end_conditions()
- Added SessionManager to autoloads in project.godot

**Files changed:**
- scripts/SessionManager.gd (new)
- project.godot (updated with SessionManager autoload)

**Learnings for future iterations:**
- SessionManager uses Time.get_unix_time_from_system() for timestamps
- start_session() ends any existing session first (prevents double-session bugs)
- Metrics are Dictionary with tap_count and content_category automatically added
- Call SessionManager.record_tap() for each user interaction
- Games can set custom auto-end limits (e.g., puzzles may end after completion, not taps)
- SessionManager.check_auto_end_conditions() should be called in game _process() or timer
- Use content_category for analytics: "cognitive" (puzzles), "creative" (painting), "musical" (piano)

## [2025-01-23] - US-008
- Created AudioManager.gd autoload singleton for all audio playback
- Functions: play_sfx(path, bus='SFX'), play_voice(path), play_music(path, loop=true)
- set_volume(bus_name, volume_db) and get_volume(bus_name) for volume control
- SFX player pool supports up to 4 simultaneous sounds via _get_available_sfx_player()
- Voice player has priority over SFX (ducking -12dB when voice plays)
- All audio paths relative to /assets/sounds/ (or use res://user:// for absolute paths)
- Audio buses: Master (0dB), Background (-8dB), SFX (-3dB), Voice (-4dB)
- Supports OGG (via AudioStreamOggVorbis), MP3, WAV formats
- Music fade in/out with fade_duration parameter (uses tween)
- Added is_voice_playing() and is_music_playing() helper functions
- stop_music(fade_duration) for smooth fade-out
- Added AudioManager to autoloads in project.godot

**Files changed:**
- scripts/AudioManager.gd (new)
- project.godot (updated with AudioManager autoload)

**Learnings for future iterations:**
- AudioStreamPlayer needs to be added as child to play audio
- Use Object pooling for frequently created/destroyed nodes (like SFX players)
- Audio bus ducking: reduce volume when priority audio plays, restore when finished
- OGG loading in Godot requires reading file buffer and assigning to AudioStreamOggVorbis.data
- MP3/WAV can be loaded directly with load() function
- AudioServer.get_bus_index() returns -1 if bus doesn't exist (check before setting volume)
- Voice ducking uses previous volume storage to restore after playback
- Fade in/out uses create_tween().tween_property() for smooth transitions
---

## [2026-01-23] - US-020, US-021, US-022
- Created PianoKey.tscn scene with Control node (50x150px)
- ColorRect for key with distinct colors (red, blue, yellow, green, orange)
- TextureRect placeholder for animal icon above each key
- Created PianoKey.gd with touch/multi-touch support via InputEventScreenTouch
- Key highlight: brightness +30% on press (BRIGHTEN_AMOUNT = 0.3), fade on release
- Haptic feedback: 30ms on press (HAPTIC_PRESS_MS), 50ms on release (HAPTIC_RELEASE_MS)
- On tap: play animal sound once; on hold: loop for max 3s (LOOP_MAX_DURATION), then fade out
- FADE_DURATION = 0.5s for smooth fade out
- Created PianoGame.tscn extending GameSceneBase
- HBoxContainer with 5 keys arranged horizontally at screen center, 2px spacing
- Created PianoGame.gd with KEY_DATA dictionary mapping keys to animals/sounds/colors
- Key mapping: C4=Komodo (red), D4=Orangutan (blue), E4=Burung (yellow), F4=Paus (green), G4=Belalang (orange)
- Multi-touch: up to 3 simultaneous sounds (MAX_POLYPHONY)
- Active sound counter (active_sounds) tracks playing sounds for polyphony limit
- Wayang mascot dances while any sound plays (wayang_dancing flag, _update_wayang_dance())
- Inactivity timer: 15 minutes (INACTIVITY_TIMEOUT = 900s), resets on key press
- Auto-fade to menu on inactivity timeout
- Session tracking: records taps, sets content_category to "musical"
- Animal sounds stored in /assets/sounds/animals/ as OGG files
- Each PianoKey has its own AudioStreamPlayer for independent playback
- AudioStreamOggVorbis used with loop enabled for sustained sounds

**Files changed:**
- scenes/PianoKey.tscn (new)
- scripts/PianoKey.gd (new)
- scenes/PianoGame.tscn (new)
- scripts/PianoGame.gd (new)
- assets/sounds/animals/README.md (new)

**Learnings for future iterations:**
- Multi-touch in Godot: use InputEventScreenTouch in _input() function, check get_rect().has_point() for local position
- For multi-touch support, set mouse_filter = MOUSE_FILTER_PASS on Control nodes
- Each key needs its own AudioStreamPlayer for independent sound playback (polyphony)
- Use Color.v (value) for brightness adjustment in HSV color space
- Haptic feedback: OS.vibrate_msec(duration_ms) works on Android/iOS
- OGG audio with loop: set stream.loop = true on AudioStreamOggVorbis
- Fade out audio: tween volume_db to -60 over duration, then stop player
- Inactivity timer pattern: accumulate delta in _process(), reset on user action
- Wayang dance sync: check active_sounds counter, start dance on press, stop when no sounds playing
- Animal sound files: komodo.ogg, orangutan.ogg, burung.ogg, paus.ogg, belalang.ogg in /assets/sounds/animals/
- Session content_category for musical games: "musical" (for analytics)
- Inactivity timeout of 15 minutes is appropriate for toddler creative play
- GameSceneBase extension: set game_name before super._ready() for proper session tracking
---
- Created Card.tscn scene with Control node (60x60px)
- Card has CardPivot child with pivot_offset at center for rotation
- Front: ColorRect (blue) with Label "?" icon
- Back: ColorRect (white) with Content ColorRect for card content
- GlowEffect ColorRect for match celebration (yellow glow)
- Created Card.gd with flipped, matched, content_id, content_color variables
- Card flip animation: rotate Y axis 0->180 degrees over 0.3s using tween
- Flip plays flip_soft.ogg SFX via AudioManager
- show_glow() method for matched cards (0.5 opacity, yellow glow)
- Created MemoryFlipGame.tscn extending GameSceneBase
- GridContainer for card layout (2x2 for ages 2-3, 2x3 for ages 4+)
- WinLabel for celebration message
- Three timers: CheckTimer (0.5s), ResetTimer (0.5s), WinTimer (3s)
- Created MemoryFlipGame.gd with game state machine (IDLE, FLIPPING, WAITING, RESET, WON)
- Loads child_age from user://child_profile.json for age gating
- Creates card pairs with matching content_id, shuffles them
- Max 2 cards flipped simultaneously (stored in flipped_cards array)
- Match check after 0.5s delay when 2 cards flipped
- Match: plays match_success.ogg, word callout based on color, glow effect
- No match: plays match_fail.ogg, flips back after 0.5s
- Win condition: all pairs matched -> celebration.ogg + "Wah hebat!" message
- Auto-transition to MainMenu after 3 seconds on win
- Session tracking: records taps, sets category to "cognitive"

**Files changed:**
- scenes/Card.tscn (new)
- scripts/Card.gd (new)
- scenes/MemoryFlipGame.tscn (new)
- scripts/MemoryFlipGame.gd (new)

**Learnings for future iterations:**
- Use pivot_offset for center-based rotation (set pivot to half of node size)
- Card flip: rotate Y axis with tween, use callback to swap front/back visibility at 90 degrees
- For 3D-like flip in 2D, set back.rotation_degrees.y = 180 initially, then rotate parent pivot
- State machine prevents clicking while animating (is_flipping flag)
- Match detection: compare content_id values, use Timer.delay for visual confirmation
- Age gating: read child_profile.json from user://, default to age 3 if file doesn't exist
- GridContainer.columns must be set dynamically based on card count
- Center grid by calculating container size and setting offset_left/right/top/bottom to negative/positive half
- Color content mapping: 0=red, 1=blue, 2=yellow, 3=green, 4=pink, 5=orange
- Use TranslationManager.get_text() for localized celebration messages
- SessionManager.set_auto_end_conditions(600, 0) for 10-minute limit, no tap limit
---

## [2026-01-23] - US-026, US-027
- Created ShapeMatchGame.tscn scene with Control root extending GameSceneBase structure
- Silhouette placeholder: ColorRect 100x100px at center with dark blue outline (Color(0.1, 0.1, 0.4, 1))
- Draggable options: 4 ColorRect shapes (60x60px) at bottom with Area2D for collision
- Content sets defined: Rumah Adat (joglo, gadang, tongkonan, kampoeng) for sessions 1-2
- Hewan content (komodo, orangutan, burung, paus) for sessions 3-4
- Mix content (combined) for sessions 5+
- Drag detection: 10px deadzone (DRAG_DEADZONE), 0.7 opacity, 1.1x scale during drag
- Drop detection: AABB overlap check between shape and silhouette using global_position
- Correct answer animation: 0.5s slide + scale tween to silhouette center (CORRECT_ANIMATION_DURATION)
- Silhouette color fill: 0.3s fade animation (COLOR_FILL_DURATION)
- Success SFX: AudioManager.play_sfx("success.ogg")
- Voice callout: AudioManager.play_voice("words/id/{id}.ogg")
- Wayang celebration: trigger via _trigger_wayang_celebration() if "celebrate" animation exists
- Auto-transition: 1.5s delay (AUTO_TRANSITION_DELAY) then next puzzle
- Incorrect drop: bounce back with TRANS_BOUNCE tween over 0.3s, gentle.ogg SFX
- Session: 5-7 puzzles (PUZZLES_PER_SESSION_MIN/MAX), 10 minute max (MAX_SESSION_DURATION = 600s)
- Session tracking: "cognitive" category, metrics include puzzles_completed, session_number
- gui_input signals connected for each option in _ready()
- Shape answer_id and color stored in Area2D meta data for validation

**Files changed:**
- scenes/ShapeMatchGame.tscn (new)
- scripts/ShapeMatchGame.gd (new)
- prd.json (updated US-026, US-027 to passes: true)

**Learnings for future iterations:**
- For drag detection with deadzone: calculate distance between drag_start_pos and current event_pos
- Use modulate.a for opacity changes during drag (0.7 for active drag state)
- Bring dragged items to front with z_index = 100 during drag
- Store original_position to return items on incorrect drop or cancel
- AABB overlap check: (shape.x < silhouette.x + silhouette.width) AND (shape.x + shape.width > silhouette.x)
- Content progression by session: use arrays of content, shuffle on load, track session_number
- Store answer metadata in node meta data: set_meta("answer_id", value), get_meta("answer_id", default)
- Slide to center animation: target_pos = silhouette.to_local(silhouette_center) - drag_target.size / 2
- Parallel tweens: tween.set_parallel(true) for simultaneous animations
- Session category "cognitive" for puzzle/matching games
- Use await tween.finished for sequential animations (slide then color fill)
- Use is_transitioning flag to prevent input during animations
- SessionManager.start_session(game_name, "cognitive") for proper category tracking

## [2026-01-23] - US-009, US-010, US-011, US-012
- Created Balloon.tscn scene with Area2D root and CollisionLayer 2 (Interactive)
- Sprite2D for balloon visual using ColorRect placeholder (80x80px)
- CollisionShape2D with CircleShape2D (40px radius)
- Balloon.gd script with _input_event for tap detection via InputEventMouseButton
- Pop animation: scale tween from 1.0 to 0 over 200ms (POP_DURATION) with EASE_OUT and TRANS_BACK easing
- Haptic feedback: OS.vibrate_msec(50) on successful tap
- Created TapPopGame.tscn extending GameSceneBase with light blue background (Color(0.85, 0.93, 1, 1))
- BalloonContainer for balloon spawning with 200px margins (SCREEN_MARGIN) from edges
- Wayang mascot placeholder in top bar for celebrations
- Balloon colors: red (#E84A3D), blue (#38BDF8), yellow (#FBBF24), green (#34D399)
- Spawn up to 3 balloons at random positions within screen bounds
- Balloons respawn 1s after pop (RESPAWN_DELAY) using Timer
- Age gating: ages 2-3 get 2 balloons (red/blue/yellow only), ages 4-5 get 3 balloons (all colors)
- Audio feedback: pop_success.ogg SFX and color word callout (warna_{color}.ogg)
- Session tracking: SessionManager.record_tap() on each pop, auto-end after 60 taps or 10 minutes
- Color translation keys: color_red, color_blue, color_yellow, color_green
- Audio paths: sounds/sfx/pop_success.ogg, sounds/words/id/warna_merah.ogg, etc.
- GameManager.get_child_age() method added for age-gating (defaults to 3)
- GameManager.set_child_age(age) method for parent dashboard to update age
- Added .gdignore in assets/sounds/ to prevent import errors for missing audio files
- Session category: "cognitive" for Tap Pop game
- Balloon removal: queue_free() called after pop animation completes via _on_pop_complete callback

**Files changed:**
- scenes/Balloon.tscn (new)
- scripts/Balloon.gd (new)
- scenes/TapPopGame.tscn (new)
- scripts/TapPopGame.gd (new)
- scripts/GameManager.gd (updated with get_child_age() and set_child_age() methods)
- assets/sounds/.gdignore (new)
- prd.json (updated US-009, US-010, US-011, US-012 to passes: true)

**Learnings for future iterations:**
- Area2D.input_event signal provides viewport, event, and shape_idx parameters
- For tap detection: check if event is InputEventMouseButton and event.pressed is true
- Pop animation pattern: tween scale to Vector2.ZERO, then use callback to queue_free()
- Balloon positioning: use container.get_size() to calculate spawn bounds, apply margins
- Age gating: read from GameManager.get_child_age(), default to age 3 if not set
- For toddler games: limit options for younger ages (2-3yo get 2 balloons, 4-5yo get 3)
- Color name translation: use dictionary to map English color names to Indonesian for audio paths
- Audio file naming: warna_merah.ogg (merah=red), warna_biru.ogg (biru=blue), etc.
- SessionManager.check_auto_end_conditions() should be called after each tap
- Use is_popping flag to prevent multiple pop animations on same balloon
- Balloon spawn timer: create Timer node in _ready(), connect timeout signal
- Session auto-end: check if SessionManager.is_session_active() after each action
- Balloon colors stored as constants dictionary for easy reference
- TranslationManager.get_text() returns localized string for color names
---

## [2026-01-23] - US-031, US-032
- Created RhythmGame.tscn scene extending GameSceneBase
- Created RhythmGame.gd script with beat tracking and tap detection
- 4 beat circles (ColorRect) arranged horizontally at center, 50x50px each, 20px spacing
- Circle colors: red, blue, yellow, green (distinct colors for visual appeal)
- Beat indicator: circle brightness pulse on beat using lightened() color in _update_beat_visuals()
- AudioStreamPlayer for backing track on Background bus
- Songs: "Twinkle Twinkle ID", "Cicak-cicak di Dinding", "Lihat Lihat Penyu" (placeholder paths)
- Beat tracker: array of timestamps at 1-second intervals (0.5s, 1.5s, 2.5s, ...)
- Tap detection: gui_input signal on each circle, handles both mouse and touch
- Timing window: ±0.3s from beat = correct tap
- Correct tap animation: circle brightens + shrinks (parallel tween with 0.3s duration)
- Particle effect: 8 particles emitted outward from circle center on correct tap
- Ding SFX: AudioManager.play_sfx("sfx/ding.ogg") on correct tap
- Missed beat: silently ignored, no error sound, no penalty
- Score tracking: correct_beats and total_beats counters (hidden from child)
- End of song: "Kamu dapat X/Y beat!" message with celebration SFX
- Auto-transition to MainMenu after 3 seconds post-song
- Wayang mascot celebration animation on correct tap
- Session tracking: "musical" category, record_tap() on each correct beat
- Duplicate tap prevention: tapped_beats array tracks already-tapped beats

**Files changed:**
- scenes/RhythmGame.tscn (new)
- scripts/RhythmGame.gd (new)
- assets/sounds/music/README.md (new)
- assets/sounds/music/.gdignore (new)
- prd.json (updated US-031, US-032 to passes: true)

**Learnings for future iterations:**
- For beat timing: use Time.get_unix_time_from_system() - song_start_time to track elapsed time
- Beat pulse detection: find beat where time_since_beat is within pulse window (0 to 0.2s)
- Closest beat finding: iterate all beats, find minimum absolute distance
- Circle brightness: use color.lightened(amount) where 0.0-1.0 is the lighten amount
- gui_input signal receives event and index when using .bind(index) in connect()
- InputEventMouseButton and InputEventScreenTouch for cross-platform tap detection
- Particle effects: create ColorRect nodes, animate outward with trigonometry (cos/sin for angle)
- Parallel tweens: use tween.set_parallel(true) for simultaneous animations
- Song finished handling: connect AudioStreamPlayer.finished signal to _on_song_finished
- Fallback for missing audio: use Timer to simulate song duration if stream fails to load
- Session category "musical" for rhythm games (consistent with Piano Hewan)
- Prevent duplicate beats: track tapped beats in array and check before counting
- .gdignore in assets/sounds/music/ prevents import errors for placeholder files

## [2026-01-23] - US-007
- Completed Main Menu Scene Layout with proper labels and tap count display
- Updated game buttons with localized labels using TranslationManager.get_text()
- All 8 game buttons now display translated names: Tap Pop, Drag Match, Memory Flip, Piano Hewan, Finger Paint, Shape Silhouette, Coloring Book, Music Rhythm
- Tap count label now shows actual play count from Database.get_todays_play_count()
- Added gear icon (⚙) to Parent button for settings access
- Added tap_count_label translation key to both id.json ("Main %dx hari ini") and en.json ("Played %dx today")
- All buttons already have min_size 120x120px for toddler touch targets (setup in previous iteration)
- MainMenu.tscn structure: VBoxContainer with LogoContainer, GameGrid (2 columns), BottomBar
- Parent button positioned at bottom-right with alignment=2

**Files changed:**
- scenes/MainMenu.tscn (updated Parent button with gear icon text)
- scripts/MainMenu.gd (added _setup_ui() with game button labels, updated _update_tap_count() with Database call)
- assets/locales/id.json (added tap_count_label key)
- assets/locales/en.json (added tap_count_label key)

**Learnings for future iterations:**
- Use TranslationManager.get_text() for all UI labels to support localization
- Database.get_todays_play_count() queries sessions table with date('now') filter
- String formatting in GDScript: "Main %dx hari ini" % count (Python-style)
- Gear icon Unicode character ⚙ works in Godot Button text property
- MainMenu already had proper structure from US-004, just needed label population
- Game button labels should be set in _ready() via _setup_ui() to ensure translations load first
---

## [2026-01-23] - US-028, US-029, US-030
- Created ColoringGame.tscn extending GameSceneBase with template selector and canvas
- Created ColoringGame.gd with flood-fill algorithm implementation
- Created 5 template images using Python (PIL): batik.png, komodo.png, anggrek.png, joglo.png, melati.png
- Templates stored in /assets/textures/coloring_templates/ with black outlines on white background
- Flood fill uses stack-based algorithm with 4-way connectivity and color matching
- 8 color palette (same as FingerPaint) with circular buttons and gold glow on active color
- Undo system with max 20 state stack storing Image.duplicate() snapshots
- Template selector with scrollable thumbnails at top of screen
- Age-based template complexity: 2-3yo (batik), 3-4yo (komodo, anggrek), 4-5yo (joglo, melati)
- Save button exports at 1200x900 resolution to user://paintings/coloring_{timestamp}.png
- Database.save_painting("Coloring", filepath, template_id) saves metadata
- Session tracking: "creative" category for painting/coloring games
- Haptic feedback on each fill (30ms vibration)
- pop_soft.ogg SFX on region fill

**Files changed:**
- scenes/ColoringGame.tscn (new)
- scripts/ColoringGame.gd (new)
- assets/textures/coloring_templates/batik.png (new)
- assets/textures/coloring_templates/komodo.png (new)
- assets/textures/coloring_templates/anggrek.png (new)
- assets/textures/coloring_templates/joglo.png (new)
- assets/textures/coloring_templates/melati.png (new)
- tools/create_templates.py (new)
- prd.json (updated US-028, US-029, US-030 to passes: true)
- progress.txt (updated)

**Learnings for future iterations:**
- Flood fill algorithm must use color matching with tolerance due to anti-aliasing artifacts
- Stack-based flood fill with visited Dictionary prevents infinite loops and is more efficient than recursion
- Image.resize() with INTERPOLATE_NEAREST maintains clean lines when scaling templates
- Template images should have black outlines on white background for best flood fill results
- TextureRect.expand_mode = EXPAND_FIT_WIDTH_PROPORTIONAL helps canvas scale nicely
- Age-based template selection uses GameManager.get_child_age() with age group buckets (2-3, 3-4, 4-5)
- Undo stack stores Image.duplicate() not texture, to ensure clean state restoration
- Color matching tolerance: use abs(c1.r - c2.r) < 0.02 for RGB components
- Session category "creative" used for all painting/coloring games
- Export resolution 1200x900 provides print quality output from 800x600 display canvas
- Python PIL (Pillow) can be used to generate placeholder template images programmatically
- Template thumbnails in selector use 100x100 resized versions for performance
---
